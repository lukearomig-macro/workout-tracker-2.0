<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="apple-mobile-web-app-title" content="Coach Protocol"/>
<meta name="theme-color" content="#080808"/>
<title>Coach Protocol</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<style>
:root{--bg:#080808;--bg1:#0F0F0F;--bg2:#161616;--bg3:#1E1E1E;--border:#222;--border2:#2A2A2A;--text:#F5F2EE;--text2:#888;--text3:#444;--pink:#F72585;--pink-dim:#3A0A1E;--pink-border:#6A1040;--green:#22C55E;--green-dim:#0A1A0A;--blue:#0EA5E9;--orange:#FF6B35;--purple:#A855F7;--slate:#64748B;--red:#EF4444;--red-dim:#1A0808;--red-border:#3A1A1A;--amber:#F59E0B;--font:'Inter',system-ui,sans-serif;--r:12px}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overscroll-behavior:none}
body{background:var(--bg);color:var(--text);font-family:var(--font);min-height:100vh;overflow-x:hidden;-webkit-font-smoothing:antialiased}
input,button,select,textarea{font-family:var(--font);-webkit-appearance:none;appearance:none}
input:focus,select:focus,textarea:focus{outline:none}
::-webkit-scrollbar{width:0}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.fade-up{animation:fadeUp 0.22s ease both}
.fade-in{animation:fadeIn 0.18s ease both}
.bottom-nav{padding-bottom:env(safe-area-inset-bottom,0px)}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const{useState,useEffect,useRef}=React;
const C={pink:"#F72585",pinkDim:"#3A0A1E",pinkBorder:"#6A1040",green:"#22C55E",greenDim:"#0A1A0A",blue:"#0EA5E9",orange:"#FF6B35",purple:"#A855F7",slate:"#64748B",red:"#EF4444",redDim:"#1A0808",redBorder:"#3A1A1A",amber:"#F59E0B",bg:"#080808",bg1:"#0F0F0F",bg2:"#161616",bg3:"#1E1E1E",border:"#222",border2:"#2A2A2A",text:"#F5F2EE",text2:"#888",text3:"#444"};
const DAYS=[
{id:1,name:"Day 1",label:"Push",sublabel:"Heavy Chest + Abs",color:C.orange,type:"training",exercises:[
{name:"Incline DB Press",sets:4,rr:[6,10],rpe:"8 / last 9",cues:"Bench 30-45. Elbows at 60 from torso. Full stretch at bottom, explosive press. Squeeze at top."},
{name:"Machine Chest Press",sets:3,rr:[8,12],rpe:"8 / last rest-pause",cues:"Mid-chest handles. Last set: go to failure, rack, rest 15s, repeat to failure."},
{name:"Low-to-High Cable Fly",sets:3,rr:[12,15],rpe:"9",cues:"Cables lowest. Arc upward and inward. Hard squeeze at top. Control the negative."},
{name:"Seated DB Shoulder Press",sets:3,rr:[8,12],rpe:"8 / last 9",cues:"Upright torso. Start at ear height. No full lockout at top. 2-3 second negative."},
{name:"Cable Lateral Raise",sets:4,rr:[12,20],rpe:"9",cues:"Lowest cable, cross-body. Lead with elbow. Thumb down at top. Slow 3-second negative."},
{name:"Rope Triceps Pushdown",sets:3,rr:[10,15],rpe:"9",cues:"Elbows pinned. Split rope at bottom. Full extension, hard squeeze. Control return."},
{name:"Ab Wheel Rollout",sets:4,rr:[6,12],rpe:"8",cues:"Brace before moving. Roll only as far as lower back stays neutral. Pull back through abs."},
{name:"Reverse Crunch",sets:4,rr:[10,15],rpe:"8",cues:"Hands under glutes. Curl pelvis to ribcage, small movement. No momentum. Lower back stays pressed down."},
{name:"Pallof Press",sets:3,rr:[20,30],rpe:"7",cues:"Cable at chest height, sideways. Brace hard. Press out and hold. Anti-rotation. Both sides."},
]},
{id:2,name:"Day 2",label:"Pull",sublabel:"Width + Thickness",color:C.blue,type:"training",exercises:[
{name:"Neutral-Grip Pulldown",sets:4,rr:[8,12],rpe:"8 / last 9",cues:"Depress shoulder blades to initiate. Elbows down and back. Lean back slightly. Full stretch at top."},
{name:"Chest-Supported Row",sets:4,rr:[8,12],rpe:"8 / last 9",cues:"Pull to lower sternum. Fully retract at top, 2-second hold. Full stretch at bottom."},
{name:"Barbell or Machine Row",sets:3,rr:[8,10],rpe:"8 / last 9",cues:"Hip hinge. Pull to lower abs. Elbows past hips. Control the descent."},
{name:"Single-Arm Lat Pull-In",sets:3,rr:[10,15],rpe:"9",cues:"Drive elbow down to hip. Full overhead stretch between reps. Torso stays still."},
{name:"Reverse Pec Deck",sets:4,rr:[12,20],rpe:"9",cues:"Arms slightly bent and locked. Elbows wide and back. Hard rear delt squeeze. Slow return."},
{name:"Incline DB Curl",sets:3,rr:[8,12],rpe:"8 / last 9",cues:"Bench 45-60. Arms fully behind. Curl without elbows drifting. Supinate at top."},
{name:"Cable Curl",sets:2,rr:[12,15],rpe:"9",cues:"Elbows fixed. Hard squeeze at top, hold for a count. Slow 3-second negative."},
]},
{id:3,name:"Day 3",label:"Legs",sublabel:"Quad Bias + Abs",color:C.green,type:"training",exercises:[
{name:"Smith Squat",sets:4,rr:[8,12],rpe:"8 / last 9",cues:"Feet slightly forward. Sit back and down. Parallel or below. Drive through whole foot."},
{name:"Romanian Deadlift",sets:4,rr:[8,12],rpe:"8 / last 9",cues:"Hip hinge. Push hips back, bar close. Deep hamstring stretch. Stop when pelvis starts to tuck."},
{name:"Bulgarian Split Squat",sets:3,rr:[8,12],rpe:"8",cues:"Rear foot elevated. Shin stays vertical. Load felt in front quad and glute."},
{name:"Leg Extension",sets:3,rr:[12,20],rpe:"9",cues:"Full extension, hold at top for a count. Slow 3-second negative."},
{name:"Lying Leg Curl",sets:3,rr:[10,15],rpe:"9",cues:"Full range. Toes pointed at top to increase contraction. Slow negative."},
{name:"Calf Raise",sets:4,rr:[8,12],rpe:"9",cues:"Full stretch at bottom. Full contraction at top, hold 1 second. No partials."},
{name:"Weighted Floor Crunch",sets:4,rr:[8,12],rpe:"8",cues:"Plate at chest. Upper back only. Hard contraction at top. Progress the weight over time."},
{name:"Ab Wheel Rollout",sets:3,rr:[6,12],rpe:"8",cues:"Brace hard. Lower back stays neutral. Pull back through abs."},
{name:"Pallof Press",sets:3,rr:[20,30],rpe:"7",cues:"Cable at chest height, sideways. Brace. Press out and hold. Both sides."},
]},
{id:4,name:"Day 4",label:"Push",sublabel:"Volume + Shape",color:C.orange,type:"training",exercises:[
{name:"Incline Smith Press",sets:4,rr:[8,12],rpe:"8 / last 9",cues:"Bench 30-45. Lower to upper chest, no bounce. Explosive press."},
{name:"Flat DB Press",sets:3,rr:[8,12],rpe:"8 / last 9",cues:"Elbows 60-75 from body. DBs below bench level at bottom. Builds mid-chest mass. Do not substitute."},
{name:"High-to-Low Cable Fly",sets:3,rr:[12,15],rpe:"9",cues:"Cables highest. Arc down and inward. Targets lower chest fibers."},
{name:"Cable Fly",sets:3,rr:[12,15],rpe:"9",cues:"Mid height. Hug a barrel. Hard squeeze at contraction. Slow negative."},
{name:"DB Lateral Raise",sets:4,rr:[15,25],rpe:"9",cues:"Slight forward lean. Lead with elbows. Just above parallel. No swinging."},
{name:"Overhead Triceps Extension",sets:3,rr:[10,15],rpe:"9",cues:"Elbows at ceiling, must not flare. Full stretch behind head. Long head focus."},
]},
{id:5,name:"Day 5",label:"Arms",sublabel:"Plus Delts",color:C.purple,type:"training",exercises:[
{name:"Cable Lateral Raise",sets:5,rr:[12,20],rpe:"9",cues:"5 sets intentional. Delts respond to volume. 3-second negative. Thumb down at top."},
{name:"Face Pull",sets:3,rr:[15,20],rpe:"7 health only",cues:"Never go heavy. Elbows high and wide, W shape at end. External rotation. Shoulder health, non-negotiable."},
{name:"EZ-Bar Curl",sets:4,rr:[8,12],rpe:"8 / last 9",cues:"Elbows fixed at sides. Full range. Supinate at top. No swinging."},
{name:"Dip Machine",sets:4,rr:[8,12],rpe:"8 / last 9",cues:"Upright posture to bias triceps. Full extension at bottom. Slow negative."},
{name:"Hammer Curl",sets:3,rr:[10,15],rpe:"9",cues:"Neutral grip. Targets brachialis. Key for arm thickness. Elbows at sides."},
{name:"Rear-Delt Cable Fly",sets:4,rr:[15,20],rpe:"9",cues:"Cables crossed. Elbows wide and back. Full range. Hard rear delt squeeze."},
]},
{id:6,name:"Day 6",label:"Rest",sublabel:"Recovery",color:C.slate,type:"rest",exercises:[]},
];
const DELOAD_EVERY=5;
const PROTEIN_TARGET=185;
const CAL_FLOORS={training:2700,rest:2300};
const FOODS=[
{name:"Chicken breast (4oz)",cal:185,pro:35,carb:0,fat:4},
{name:"Ground beef 90pct (4oz)",cal:200,pro:24,carb:0,fat:11},
{name:"Salmon (4oz)",cal:234,pro:25,carb:0,fat:14},
{name:"Eggs (2 large)",cal:140,pro:12,carb:1,fat:10},
{name:"Greek yogurt (1 cup)",cal:130,pro:22,carb:8,fat:0},
{name:"Cottage cheese (1 cup)",cal:206,pro:28,carb:8,fat:5},
{name:"Whey protein (1 scoop)",cal:130,pro:25,carb:3,fat:2},
{name:"Oats (1 cup dry)",cal:307,pro:11,carb:55,fat:5},
{name:"White rice (1 cup cooked)",cal:206,pro:4,carb:45,fat:0},
{name:"Banana (medium)",cal:105,pro:1,carb:27,fat:0},
{name:"Sweet potato (medium)",cal:103,pro:2,carb:24,fat:0},
{name:"Bread (2 slices)",cal:160,pro:6,carb:30,fat:2},
{name:"Pasta (2oz dry)",cal:200,pro:7,carb:42,fat:1},
{name:"Avocado (half)",cal:120,pro:1,carb:6,fat:11},
{name:"Olive oil (1 tbsp)",cal:120,pro:0,carb:0,fat:14},
{name:"Mixed nuts (1oz)",cal:172,pro:5,carb:6,fat:15},
{name:"Milk (1 cup)",cal:149,pro:8,carb:12,fat:8},
{name:"Steak (4oz)",cal:280,pro:28,carb:0,fat:18},
{name:"Tuna can (3oz)",cal:100,pro:22,carb:0,fat:1},
{name:"Peanut butter (2 tbsp)",cal:190,pro:8,carb:6,fat:16},
{name:"Apple (medium)",cal:95,pro:0,carb:25,fat:0},
{name:"Protein bar",cal:200,pro:20,carb:22,fat:6},
{name:"Honey (1 tbsp)",cal:64,pro:0,carb:17,fat:0},
{name:"Cheese (1oz)",cal:113,pro:7,carb:0,fat:9},
{name:"Collagen peptides (1 scoop)",cal:35,pro:9,carb:0,fat:0},
];
function todayStr(){return new Date().toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});}
function todayKey(){const d=new Date();return d.getFullYear()+"-"+d.getMonth()+"-"+d.getDate();}
function loadData(){try{return JSON.parse(localStorage.getItem("cp_v5"))||{sessions:[],weightLog:[],nutritionLog:[],weekCount:1,sessionCount:0};}catch{return{sessions:[],weightLog:[],nutritionLog:[],weekCount:1,sessionCount:0};}}
function checkProg(sessions,exName,rr){
  const rel=sessions.filter(s=>s.entries&&s.entries.some(e=>e.exerciseName===exName)).slice(-2);
  if(rel.length<2)return null;
  if(!rel.every(s=>{const e=s.entries.find(e=>e.exerciseName===exName);return e&&e.sets.filter(s=>s.reps).every(set=>parseInt(set.reps)>=rr[1]);}))return null;
  const le=rel[1].entries.find(e=>e.exerciseName===exName);
  return le&&le.sets&&le.sets[0]?le.sets[0].weight||"BW":null;
}
function getTrend(log){const l=log.slice(-7);if(l.length<3)return null;return l[l.length-1].weight-l[0].weight;}
function Label({children,color,style={}}){return <span style={{fontSize:10,fontWeight:600,letterSpacing:"0.12em",textTransform:"uppercase",color:color||C.text3,...style}}>{children}</span>;}
function Card({children,accent,style={},onClick}){return <div onClick={onClick} style={{background:C.bg1,border:"1px solid "+(accent||C.border),borderRadius:12,padding:16,marginBottom:10,...style}}>{children}</div>;}
function ProgressBar({value,max,color,style={}}){const pct=Math.min(1,value/max);return <div style={{height:3,background:C.bg3,borderRadius:3,overflow:"hidden",...style}}><div style={{height:"100%",background:color||C.pink,borderRadius:3,width:(pct*100)+"%",transition:"width 0.4s ease"}}/></div>;}
function ConfirmInline({message,onConfirm,onCancel,confirmLabel="Yes",cancelLabel="No",danger=true}){return <div style={{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}}><span style={{fontSize:12,color:C.text2}}>{message}</span><button onClick={onConfirm} style={{background:danger?C.red:"none",border:"1px solid "+(danger?C.red:C.border2),borderRadius:6,padding:"5px 12px",color:"#fff",fontSize:11,cursor:"pointer",fontFamily:"inherit"}}>{confirmLabel}</button><button onClick={onCancel} style={{background:"none",border:"1px solid "+C.border2,borderRadius:6,padding:"5px 12px",color:C.text2,fontSize:11,cursor:"pointer",fontFamily:"inherit"}}>{cancelLabel}</button></div>;}
function Stopwatch(){
  const[running,setRunning]=useState(false);
  const[elapsed,setElapsed]=useState(0);
  const ref=useRef(null);
  useEffect(()=>{if(running){ref.current=setInterval(()=>setElapsed(e=>e+1),1000);}else clearInterval(ref.current);return()=>clearInterval(ref.current);},[running]);
  const m=Math.floor(elapsed/60),s=elapsed%60;
  function toggle(){if(running){setRunning(false);setElapsed(0);}else{setElapsed(0);setRunning(true);}}
  return <div style={{display:"flex",alignItems:"center",gap:12,background:C.bg2,border:"1px solid "+C.border,borderRadius:10,padding:"10px 16px",marginBottom:16}}><Label color={C.text3} style={{flex:1}}>Rest Timer</Label><div style={{fontSize:20,fontWeight:700,color:running?C.green:C.text3,fontVariantNumeric:"tabular-nums",minWidth:52,textAlign:"center"}}>{m}:{String(s).padStart(2,"0")}</div><button onClick={toggle} style={{background:running?C.greenDim:"none",border:"1px solid "+(running?C.green:C.border2),borderRadius:8,padding:"6px 16px",color:running?C.green:C.text2,fontSize:11,fontWeight:600,letterSpacing:"0.08em",textTransform:"uppercase",cursor:"pointer",fontFamily:"inherit"}}>{running?"Stop":"Start"}</button></div>;
}
const NAV_ICONS={
  home:<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
  nutrition:<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>,
  weight:<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>,
  history:<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
  coach:<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
};
function BottomNav({view,setView,alertCount}){
  const tabs=[["home","Home"],["nutrition","Fuel"],["weight","Scale"],["history","History"],["coach","Coach"]];
  return <div className="bottom-nav" style={{position:"fixed",bottom:0,left:"50%",transform:"translateX(-50%)",width:"100%",maxWidth:480,background:"rgba(8,8,8,0.95)",borderTop:"1px solid "+C.border,backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",zIndex:100,display:"flex"}}>
    {tabs.map(([v,label])=>{
      const active=view===v,isCoach=v==="coach";
      return <button key={v} onClick={()=>setView(v)} style={{flex:1,background:"none",border:"none",padding:"10px 0 8px",color:active?C.pink:C.text3,cursor:"pointer",fontFamily:"inherit",position:"relative",display:"flex",flexDirection:"column",alignItems:"center",gap:3,transition:"color 0.15s"}}>
        {NAV_ICONS[v]}
        <span style={{fontSize:9,fontWeight:active?700:400,letterSpacing:"0.06em",textTransform:"uppercase"}}>{label}</span>
        {isCoach&&alertCount>0&&<span style={{position:"absolute",top:8,right:"calc(50% - 14px)",background:C.pink,borderRadius:99,width:16,height:16,fontSize:9,fontWeight:700,color:"#fff",display:"flex",alignItems:"center",justifyContent:"center"}}>{alertCount}</span>}
        {active&&<div style={{position:"absolute",bottom:0,left:"50%",transform:"translateX(-50%)",width:20,height:2,background:C.pink,borderRadius:2}}/>}
      </button>;
    })}
  </div>;
}
function HomeView({data,alerts,isDeload,onStartSession,onLogRest,setView}){
  const[sel,setSel]=useState(null);
  const[restType,setRestType]=useState("Full Rest");
  const[restNotes,setRestNotes]=useState("");
  const restTypes=["Full Rest","Zone 2 Walk","Zone 2 Cardio","Mobility","Active Recovery"];
  const latestWeight=data.weightLog.length?data.weightLog[data.weightLog.length-1].weight:null;
  const trend=getTrend(data.weightLog);
  const trainCount=data.sessions.filter(s=>s.type==="training").length;
  return <div className="fade-up">
    <div style={{padding:"56px 20px 20px",display:"flex",alignItems:"center",justifyContent:"space-between"}}>
      <div style={{display:"flex",alignItems:"center",gap:12}}>
        <div style={{width:38,height:38,borderRadius:10,background:C.pink,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20}}>üèãÔ∏è</div>
        <div><div style={{fontSize:18,fontWeight:700,letterSpacing:"-0.02em"}}>Coach Protocol</div><div style={{fontSize:11,color:C.text3,fontWeight:500}}>Round + Cut System</div></div>
      </div>
      <div style={{textAlign:"right"}}>
        <Label color={C.text3}>Week</Label>
        <div style={{fontSize:32,fontWeight:800,color:isDeload?C.pink:C.text,lineHeight:1,letterSpacing:"-0.03em",marginTop:2}}>{data.weekCount}</div>
        {isDeload&&<div style={{fontSize:9,fontWeight:700,color:C.pink,letterSpacing:"0.1em",textTransform:"uppercase"}}>DELOAD</div>}
      </div>
    </div>
    {(latestWeight||trainCount>0)&&<div style={{display:"flex",gap:10,padding:"0 20px 16px"}}>
      {latestWeight&&<div style={{flex:1,background:C.bg1,border:"1px solid "+C.border,borderRadius:10,padding:"10px 14px"}}>
        <Label color={C.text3} style={{display:"block"}}>Weight</Label>
        <div style={{fontSize:20,fontWeight:700,marginTop:4,letterSpacing:"-0.02em"}}>{latestWeight}<span style={{fontSize:12,fontWeight:500,color:C.text3}}> lbs</span></div>
        {trend!==null&&<div style={{fontSize:11,color:trend<-0.25?C.pink:trend>0.5?C.green:C.amber,marginTop:2,fontWeight:500}}>{trend>0?"+":""}{trend.toFixed(1)} / 7d</div>}
      </div>}
      <div style={{flex:1,background:C.bg1,border:"1px solid "+C.border,borderRadius:10,padding:"10px 14px"}}>
        <Label color={C.text3} style={{display:"block"}}>Sessions</Label>
        <div style={{fontSize:20,fontWeight:700,marginTop:4,letterSpacing:"-0.02em"}}>{trainCount}</div>
        <div style={{fontSize:11,color:C.text3,marginTop:2,fontWeight:500}}>this program</div>
      </div>
    </div>}
    {alerts.length>0&&<div onClick={()=>setView("coach")} style={{margin:"0 20px 16px",background:C.pinkDim,border:"1px solid "+C.pinkBorder,borderRadius:12,padding:"12px 16px",cursor:"pointer"}}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><Label color={C.pink}>{alerts.length} Coach Alert{alerts.length>1?"s":""}</Label><span style={{fontSize:11,color:C.pink}}>View all</span></div>
      <div style={{fontSize:13,color:"#F5A0C0",marginTop:6,lineHeight:1.5,fontWeight:500}}>{alerts[0].msg}</div>
    </div>}
    <div style={{padding:"0 20px 100px"}}>
      <Label color={C.text3} style={{display:"block",marginBottom:12}}>Training Days</Label>
      {DAYS.map(d=>{
        const last=[...data.sessions].reverse().find(s=>s.dayId===d.id);
        const open=sel===d.id;
        return <div key={d.id} style={{marginBottom:8,borderRadius:14,overflow:"hidden",border:"1px solid "+(open?d.color:C.border),background:open?C.bg2:C.bg1,transition:"all 0.15s"}}>
          <div onClick={()=>setSel(open?null:d.id)} style={{padding:"14px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:14}}>
            <div style={{width:3,height:36,background:d.color,borderRadius:3,flexShrink:0}}/>
            <div style={{flex:1}}>
              <div style={{fontSize:11,fontWeight:700,letterSpacing:"0.1em",textTransform:"uppercase",color:d.color,marginBottom:3}}>{d.name}</div>
              <div style={{fontSize:15,fontWeight:600,letterSpacing:"-0.01em"}}>{d.label} <span style={{fontWeight:400,color:C.text2}}>‚Äî {d.sublabel}</span></div>
            </div>
            <div style={{textAlign:"right"}}>
              {last&&<div style={{fontSize:10,color:C.text3,marginBottom:4,fontWeight:500}}>{last.date}</div>}
              <div style={{fontSize:16,color:C.text3,fontWeight:300}}>{open?"‚àí":"+"}</div>
            </div>
          </div>
          {open&&<div style={{borderTop:"1px solid "+C.border}}>
            {d.type==="rest"?<div style={{padding:16}}>
              <Label color={C.slate} style={{display:"block",marginBottom:12}}>Log as</Label>
              <div style={{display:"flex",flexWrap:"wrap",gap:8,marginBottom:12}}>{restTypes.map(t=><button key={t} onClick={()=>setRestType(t)} style={{background:restType===t?C.bg3:"none",border:"1px solid "+(restType===t?C.slate:C.border2),borderRadius:20,padding:"5px 14px",color:restType===t?C.text:C.text3,fontSize:11,fontWeight:restType===t?600:400,cursor:"pointer",fontFamily:"inherit"}}>{t}</button>)}</div>
              <textarea value={restNotes} onChange={e=>setRestNotes(e.target.value)} placeholder="Notes (optional)" style={{width:"100%",background:C.bg,border:"1px solid "+C.border2,borderRadius:8,padding:"10px 12px",color:C.text,fontSize:13,fontFamily:"inherit",resize:"none",height:64,marginBottom:12}}/>
              <button onClick={()=>{onLogRest(restType,restNotes);setSel(null);setRestNotes("");}} style={{width:"100%",background:C.slate,border:"none",color:"#fff",padding:"13px 0",borderRadius:10,fontSize:12,fontWeight:700,letterSpacing:"0.08em",textTransform:"uppercase",cursor:"pointer",fontFamily:"inherit"}}>Log Rest Day</button>
            </div>:<div style={{padding:16}}>
              {d.exercises.map((ex,i)=><div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"7px 0",borderBottom:i<d.exercises.length-1?"1px solid "+C.border:"none"}}><span style={{fontSize:13,fontWeight:500}}>{ex.name}</span><span style={{fontSize:11,color:C.text3,fontWeight:500}}>{ex.sets}x{ex.rr[0]}-{ex.rr[1]}</span></div>)}
              <button onClick={()=>onStartSession(d.id)} style={{width:"100%",background:d.color,border:"none",color:"#fff",padding:"13px 0",borderRadius:10,fontSize:12,fontWeight:700,letterSpacing:"0.08em",textTransform:"uppercase",cursor:"pointer",fontFamily:"inherit",marginTop:14}}>{isDeload?"Start Deload Session":"Start Session"}</button>
            </div>}
          </div>}
        </div>;
      })}
    </div>
  </div>;
}
function LogView({data,session,setSession,activeDay,isDeload,onFinish,onCancel}){
  const[exIdx,setExIdx]=useState(0);
  const[showCues,setShowCues]=useState(false);
  const[cancelConfirm,setCancelConfirm]=useState(false);
  const aPEx=activeDay?activeDay.exercises[exIdx]:null;
  const aSEx=session?session.exercises[exIdx]:null;
  if(!session||!aPEx||!aSEx)return null;
  function updField(ei,si,f,v){setSession(prev=>({...prev,exercises:prev.exercises.map((ex,i)=>i!==ei?ex:{...ex,sets:ex.sets.map((s,j)=>j!==si?s:{...s,[f]:v})})}));}
  function markDone(si){setSession(prev=>({...prev,exercises:prev.exercises.map((ex,i)=>i!==exIdx?ex:{...ex,sets:ex.sets.map((s,j)=>j!==si?s:{...s,done:!s.done})})}));}
  function addSet(){setSession(prev=>({...prev,exercises:prev.exercises.map((ex,i)=>i!==exIdx?ex:{...ex,sets:[...ex.sets,{weight:"",reps:"",rpe:"",done:false}]})}));}
  function removeSet(si){if(aSEx.sets.length<=1)return;setSession(prev=>({...prev,exercises:prev.exercises.map((ex,i)=>i!==exIdx?ex:{...ex,sets:ex.sets.filter((_,j)=>j!==si)})}));}
  const prev=[...data.sessions].reverse().find(s=>s.dayId===session.dayId&&s.entries&&s.entries.some(e=>e.exerciseName===aPEx.name));
  const pe=prev&&prev.entries?prev.entries.find(e=>e.exerciseName===aPEx.name):null;
  const completedCount=session.exercises.filter(ex=>ex.sets.every(s=>s.done)).length;
  const accentColor=activeDay&&activeDay.color?activeDay.color:C.pink;
  return <div className="fade-in" style={{minHeight:"100vh",display:"flex",flexDirection:"column"}}>
    <div style={{padding:"52px 20px 0",background:C.bg,borderBottom:"1px solid "+C.border,position:"sticky",top:0,zIndex:50}}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
        <div><Label color={accentColor}>{activeDay.label} ‚Äî {activeDay.sublabel}</Label><div style={{marginTop:4,fontSize:12,color:C.text3,fontWeight:500}}>{completedCount}/{session.exercises.length} done</div></div>
        {!cancelConfirm?<button onClick={()=>setCancelConfirm(true)} style={{background:"none",border:"1px solid "+C.redBorder,borderRadius:8,padding:"7px 14px",color:C.red,fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"inherit",textTransform:"uppercase",letterSpacing:"0.06em"}}>End</button>
        :<ConfirmInline message="End session?" onConfirm={onCancel} onCancel={()=>setCancelConfirm(false)} confirmLabel="Yes end" cancelLabel="Keep going"/>}
      </div>
      <ProgressBar value={completedCount} max={session.exercises.length} color={accentColor} style={{marginBottom:10}}/>
      <div style={{display:"flex",gap:6,overflowX:"auto",paddingBottom:12}}>
        {session.exercises.map((ex,i)=>{const allDone=ex.sets.every(s=>s.done),active=i===exIdx;return <button key={i} onClick={()=>{setExIdx(i);setShowCues(false);}} style={{flexShrink:0,background:active?C.bg3:"none",border:"1px solid "+(active?accentColor:allDone?C.green:C.border),borderRadius:20,padding:"4px 12px",color:active?C.text:allDone?C.green:C.text3,fontSize:11,fontWeight:active?600:400,cursor:"pointer",fontFamily:"inherit",whiteSpace:"nowrap"}}>{allDone?"ok ":""}{i+1}</button>;})}
      </div>
    </div>
    <div style={{flex:1,padding:"20px 20px 40px",overflowY:"auto"}}>
      {isDeload&&<div style={{background:C.pinkDim,border:"1px solid "+C.pinkBorder,borderRadius:10,padding:"10px 14px",marginBottom:16,fontSize:12,fontWeight:500,color:"#F5A0C0"}}>Deload week ‚Äî 60% weight, half sets, RPE 6 max.</div>}
      <div style={{marginBottom:16}}>
        <div style={{fontSize:26,fontWeight:800,letterSpacing:"-0.02em",lineHeight:1.1,marginBottom:6}}>{aPEx.name}</div>
        <div style={{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"}}>
          <span style={{fontSize:12,fontWeight:600,color:accentColor}}>{aPEx.sets} sets</span>
          <span style={{fontSize:12,color:C.text3}}>¬∑</span>
          <span style={{fontSize:12,fontWeight:500,color:C.text2}}>{aPEx.rr[0]}-{aPEx.rr[1]} reps</span>
          <span style={{fontSize:12,color:C.text3}}>¬∑</span>
          <span style={{fontSize:12,fontWeight:500,color:C.text2}}>RPE {aPEx.rpe}</span>
        </div>
      </div>
      <Stopwatch/>
      {pe&&pe.sets.length>0?<Card style={{marginBottom:16}}><Label color={C.text3} style={{display:"block",marginBottom:10}}>Last session ‚Äî {prev.date}</Label><div style={{display:"flex",flexWrap:"wrap",gap:6}}>{pe.sets.map((s,i)=><div key={i} style={{background:C.bg2,borderRadius:8,padding:"6px 10px",fontSize:12,fontWeight:500,color:C.text2}}>{s.weight?s.weight+"lb":"BW"} x {s.reps}{s.rpe?" @"+s.rpe:""}</div>)}</div></Card>
      :<Card style={{marginBottom:16}}><Label color={C.text3}>First time ‚Äî establish your baseline</Label></Card>}
      <button onClick={()=>setShowCues(!showCues)} style={{background:"none",border:"1px solid "+C.border2,borderRadius:8,padding:"7px 14px",color:C.text2,fontSize:11,fontWeight:600,letterSpacing:"0.06em",textTransform:"uppercase",cursor:"pointer",fontFamily:"inherit",marginBottom:16}}>{showCues?"Hide Cues":"Form Cues"}</button>
      {showCues&&<div style={{background:C.bg1,border:"1px solid "+C.border,borderRadius:10,padding:14,fontSize:13,color:C.text2,lineHeight:1.7,marginBottom:16}}>{aPEx.cues}</div>}
      <Label color={C.text3} style={{display:"block",marginBottom:10}}>Log Sets</Label>
      {aSEx.sets.map((s,si)=><div key={si} style={{background:s.done?C.greenDim:C.bg1,border:"1px solid "+(s.done?C.green:C.border),borderRadius:12,padding:"12px 14px",marginBottom:8,transition:"all 0.2s"}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:s.done?0:10}}>
          <span style={{fontSize:11,fontWeight:700,color:s.done?C.green:C.text3,letterSpacing:"0.08em",textTransform:"uppercase"}}>{s.done?"done ":""}Set {si+1}</span>
          <div style={{display:"flex",gap:8,alignItems:"center"}}>
            {s.done&&<span style={{fontSize:12,fontWeight:600,color:C.green}}>{s.weight?s.weight+"lb":"BW"} x {s.reps}{s.rpe?" @"+s.rpe:""}</span>}
            <button onClick={()=>removeSet(si)} style={{background:"none",border:"1px solid "+C.border,borderRadius:6,color:C.text3,cursor:"pointer",fontSize:12,padding:"3px 8px",fontFamily:"inherit"}}>x</button>
            <button onClick={()=>markDone(si)} style={{background:s.done?C.greenDim:"none",border:"1px solid "+(s.done?C.green:C.border2),borderRadius:8,padding:"6px 14px",color:s.done?C.green:C.text2,fontSize:11,fontWeight:600,letterSpacing:"0.06em",textTransform:"uppercase",cursor:"pointer",fontFamily:"inherit"}}>{s.done?"Undo":"Done"}</button>
          </div>
        </div>
        {!s.done&&<div style={{display:"flex",gap:8}}>
          <div style={{flex:1}}><Label color={C.text3} style={{display:"block",marginBottom:4,textAlign:"center"}}>lbs</Label><input placeholder="0" value={s.weight} onChange={e=>updField(exIdx,si,"weight",e.target.value)} inputMode="decimal" style={{width:"100%",background:C.bg,border:"1px solid "+C.border2,borderRadius:8,padding:"11px",color:C.text,fontSize:18,fontWeight:700,fontFamily:"inherit",textAlign:"center"}}/></div>
          <div style={{flex:1}}><Label color={C.text3} style={{display:"block",marginBottom:4,textAlign:"center"}}>reps</Label><input placeholder="0" value={s.reps} onChange={e=>updField(exIdx,si,"reps",e.target.value)} inputMode="numeric" style={{width:"100%",background:C.bg,border:"1px solid "+C.border2,borderRadius:8,padding:"11px",color:C.text,fontSize:18,fontWeight:700,fontFamily:"inherit",textAlign:"center"}}/></div>
          <div style={{width:72}}><Label color={C.text3} style={{display:"block",marginBottom:4,textAlign:"center"}}>RPE</Label><input placeholder="8" value={s.rpe} onChange={e=>updField(exIdx,si,"rpe",e.target.value)} inputMode="decimal" style={{width:"100%",background:C.bg,border:"1px solid "+C.border2,borderRadius:8,padding:"11px",color:C.text,fontSize:18,fontWeight:700,fontFamily:"inherit",textAlign:"center"}}/></div>
        </div>}
      </div>)}
      <button onClick={addSet} style={{width:"100%",background:"none",border:"1px dashed "+C.border2,color:C.text3,padding:"11px 0",borderRadius:10,fontSize:12,fontWeight:600,cursor:"pointer",fontFamily:"inherit",letterSpacing:"0.06em",textTransform:"uppercase",marginBottom:20}}>+ Add Set</button>
      <div style={{display:"flex",gap:10}}>
        {exIdx>0&&<button onClick={()=>{setExIdx(i=>i-1);setShowCues(false);}} style={{flex:1,background:"none",border:"1px solid "+C.border,color:C.text2,padding:"14px 0",borderRadius:10,fontSize:12,fontWeight:700,cursor:"pointer",fontFamily:"inherit",letterSpacing:"0.06em",textTransform:"uppercase"}}>Back</button>}
        {exIdx<session.exercises.length-1?<button onClick={()=>{setExIdx(i=>i+1);setShowCues(false);}} style={{flex:2,background:accentColor,border:"none",color:"#fff",padding:"14px 0",borderRadius:10,fontSize:12,fontWeight:700,cursor:"pointer",fontFamily:"inherit",letterSpacing:"0.06em",textTransform:"uppercase"}}>Next</button>
        :<button onClick={onFinish} style={{flex:2,background:C.green,border:"none",color:"#fff",padding:"14px 0",borderRadius:10,fontSize:12,fontWeight:700,cursor:"pointer",fontFamily:"inherit",letterSpacing:"0.06em",textTransform:"uppercase"}}>Finish</button>}
      </div>
    </div>
  </div>;
}
function SessionDone({alerts,onBack}){
  return <div className="fade-up" style={{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px 20px 120px",textAlign:"center"}}>
    <div style={{width:72,height:72,background:C.greenDim,border:"1px solid "+C.green,borderRadius:72,display:"flex",alignItems:"center",justifyContent:"center",fontSize:32,marginBottom:24}}>‚úì</div>
    <div style={{fontSize:28,fontWeight:800,letterSpacing:"-0.02em",marginBottom:8}}>Session complete.</div>
    <div style={{fontSize:13,color:C.text3,fontWeight:500,marginBottom:40}}>Data saved. Coach alerts updated.</div>
    {alerts.length>0&&<div style={{width:"100%",maxWidth:360,background:C.pinkDim,border:"1px solid "+C.pinkBorder,borderRadius:12,padding:16,marginBottom:24,textAlign:"left"}}>
      <Label color={C.pink} style={{display:"block",marginBottom:10}}>Alerts</Label>
      {alerts.map((a,i)=><div key={i} style={{fontSize:13,color:"#F5A0C0",marginBottom:8,lineHeight:1.5,fontWeight:500}}>{a.msg}</div>)}
    </div>}
    <button onClick={onBack} style={{background:C.pink,border:"none",color:"#fff",padding:"14px 40px",borderRadius:10,fontSize:13,fontWeight:700,cursor:"pointer",fontFamily:"inherit",letterSpacing:"0.08em",textTransform:"uppercase"}}>Back to Program</button>
  </div>;
}
function NutritionView({data,setData}){
  const[sel,setSel]=useState("");
  const[showC,setShowC]=useState(false);
  const[cn,setCn]=useState("");const[cc,setCc]=useState("");const[cp,setCp]=useState("");const[ccb,setCcb]=useState("");const[cf,setCf]=useState("");
  const[dt,setDt]=useState("training");
  const key=todayKey();
  const tlog=data.nutritionLog.filter(e=>e.dayKey===key);
  const tot=tlog.reduce((a,e)=>({cal:a.cal+(e.cal||0),pro:a.pro+(e.pro||0),carb:a.carb+(e.carb||0),fat:a.fat+(e.fat||0)}),{cal:0,pro:0,carb:0,fat:0});
  const floor=CAL_FLOORS[dt];
  const inp={width:"100%",background:C.bg,border:"1px solid "+C.border2,borderRadius:8,padding:"11px 12px",color:C.text,fontSize:14,fontFamily:"inherit"};
  function addFood(){const food=FOODS.find(f=>f.name===sel);if(!food)return;setData(prev=>({...prev,nutritionLog:[...prev.nutritionLog,{...food,dayKey:key,date:todayStr(),id:Date.now()}]}));setSel("");}
  function addCustom(){if(!cn||!cc)return;setData(prev=>({...prev,nutritionLog:[...prev.nutritionLog,{name:cn,cal:parseInt(cc)||0,pro:parseInt(cp)||0,carb:parseInt(ccb)||0,fat:parseInt(cf)||0,dayKey:key,date:todayStr(),id:Date.now()}]}));setCn("");setCc("");setCp("");setCcb("");setCf("");setShowC(false);}
  function remove(id){setData(prev=>({...prev,nutritionLog:prev.nutritionLog.filter(e=>e.id!==id)}));}
  return <div className="fade-up" style={{padding:"56px 20px 100px"}}>
    <div style={{marginBottom:20}}><div style={{fontSize:22,fontWeight:800,letterSpacing:"-0.02em",marginBottom:4}}>Nutrition</div><div style={{fontSize:12,color:C.text3,fontWeight:500}}>Hit your floors, not perfection</div></div>
    <div style={{display:"flex",gap:8,marginBottom:16}}>{["training","rest"].map(t=><button key={t} onClick={()=>setDt(t)} style={{flex:1,background:dt===t?C.bg2:"none",border:"1px solid "+(dt===t?C.pink:C.border),borderRadius:8,padding:"8px 0",color:dt===t?C.text:C.text3,fontSize:11,fontWeight:dt===t?700:400,letterSpacing:"0.06em",textTransform:"uppercase",cursor:"pointer",fontFamily:"inherit"}}>{t==="training"?"Training":"Rest"}</button>)}</div>
    <Card style={{marginBottom:16}}>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:16}}>
        <div style={{textAlign:"center"}}><div style={{fontSize:42,fontWeight:800,color:tot.cal>=floor?C.green:C.text,lineHeight:1,letterSpacing:"-0.03em"}}>{tot.cal}</div><Label color={C.text3} style={{display:"block",marginTop:4}}>Calories</Label><div style={{fontSize:11,color:C.text3,marginTop:2}}>floor {floor}</div></div>
        <div style={{textAlign:"center"}}><div style={{fontSize:42,fontWeight:800,color:tot.pro>=PROTEIN_TARGET?C.green:C.text,lineHeight:1,letterSpacing:"-0.03em"}}>{tot.pro}g</div><Label color={C.text3} style={{display:"block",marginTop:4}}>Protein</Label><div style={{fontSize:11,color:C.text3,marginTop:2}}>target {PROTEIN_TARGET}g</div></div>
      </div>
      <div style={{display:"flex",gap:20,justifyContent:"center",marginBottom:16}}>
        {[["Carbs",tot.carb+"g"],["Fat",tot.fat+"g"]].map(([l,v])=><div key={l} style={{textAlign:"center"}}><div style={{fontSize:20,fontWeight:700,letterSpacing:"-0.02em"}}>{v}</div><Label color={C.text3} style={{display:"block",marginTop:3}}>{l}</Label></div>)}
      </div>
      <div style={{display:"flex",gap:10}}>
        <div style={{flex:1}}><div style={{display:"flex",justifyContent:"space-between",marginBottom:4}}><Label color={C.text3}>Cal</Label><Label color={C.text3}>{Math.round(Math.min(1,tot.cal/floor)*100)}%</Label></div><ProgressBar value={tot.cal} max={floor} color={tot.cal>=floor?C.green:C.pink}/></div>
        <div style={{flex:1}}><div style={{display:"flex",justifyContent:"space-between",marginBottom:4}}><Label color={C.text3}>Protein</Label><Label color={C.text3}>{Math.round(Math.min(1,tot.pro/PROTEIN_TARGET)*100)}%</Label></div><ProgressBar value={tot.pro} max={PROTEIN_TARGET} color={tot.pro>=PROTEIN_TARGET?C.green:C.blue}/></div>
      </div>
    </Card>
    <Card style={{marginBottom:16}}>
      <Label color={C.text3} style={{display:"block",marginBottom:10}}>Add Food</Label>
      <select value={sel} onChange={e=>setSel(e.target.value)} style={{...inp,marginBottom:10,color:sel?C.text:C.text3}}>
        <option value="">Select a food...</option>
        {FOODS.map(f=><option key={f.name} value={f.name}>{f.name} ‚Äî {f.cal}cal / {f.pro}g protein</option>)}
      </select>
      <button onClick={addFood} style={{width:"100%",background:C.pink,border:"none",color:"#fff",padding:"12px 0",borderRadius:8,fontSize:12,fontWeight:700,letterSpacing:"0.08em",textTransform:"uppercase",cursor:"pointer",fontFamily:"inherit",marginBottom:10}}>Add to Log</button>
      <button onClick={()=>setShowC(!showC)} style={{width:"100%",background:"none",border:"1px dashed "+C.border2,color:C.text3,padding:"9px 0",borderRadius:8,fontSize:11,fontWeight:600,letterSpacing:"0.06em",textTransform:"uppercase",cursor:"pointer",fontFamily:"inherit"}}>{showC?"Hide Custom":"+ Custom Food"}</button>
      {showC&&<div style={{marginTop:12}}>
        <input placeholder="Food name" value={cn} onChange={e=>setCn(e.target.value)} style={{...inp,marginBottom:8}}/>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:6,marginBottom:8}}>
          {[["Cal",cc,setCc],["Pro",cp,setCp],["Carb",ccb,setCcb],["Fat",cf,setCf]].map(([l,v,fn])=><div key={l}><Label color={C.text3} style={{display:"block",textAlign:"center",marginBottom:3}}>{l}</Label><input value={v} onChange={e=>fn(e.target.value)} inputMode="numeric" style={{...inp,textAlign:"center",padding:"8px 4px",fontSize:14}}/></div>)}
        </div>
        <button onClick={addCustom} style={{width:"100%",background:C.bg2,border:"1px solid "+C.border,color:C.text,padding:"10px 0",borderRadius:8,fontSize:12,fontWeight:600,cursor:"pointer",fontFamily:"inherit"}}>Add Custom</button>
      </div>}
    </Card>
    {tlog.length>0&&<div><Label color={C.text3} style={{display:"block",marginBottom:10}}>Today</Label>{tlog.map(e=><div key={e.id} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderBottom:"1px solid "+C.border}}><div><div style={{fontSize:13,fontWeight:500}}>{e.name}</div><div style={{fontSize:11,color:C.text3,marginTop:2}}>{e.cal}cal ¬∑ {e.pro}g pro ¬∑ {e.carb}g carb ¬∑ {e.fat}g fat</div></div><button onClick={()=>remove(e.id)} style={{background:"none",border:"none",color:C.text3,fontSize:18,cursor:"pointer",padding:"0 4px"}}>x</button></div>)}</div>}
  </div>;
}
function WeightView({data,setData}){
  const[inp,setInp]=useState("");
  const trend=getTrend(data.weightLog);
  const last7=data.weightLog.slice(-7);
  const tc=trend===null?C.text3:trend>0.5?C.green:trend<-0.25?C.pink:C.amber;
  function log(){const w=parseFloat(inp);if(!w)return;setData(prev=>({...prev,weightLog:[...prev.weightLog.filter(e=>e.key!==todayKey()),{weight:w,date:todayStr(),key:todayKey(),id:Date.now()}].sort((a,b)=>a.id-b.id)}));setInp("");}
  const latest=data.weightLog.length?data.weightLog[data.weightLog.length-1].weight:null;
  return <div className="fade-up" style={{padding:"56px 20px 100px"}}>
    <div style={{marginBottom:20}}><div style={{fontSize:22,fontWeight:800,letterSpacing:"-0.02em",marginBottom:4}}>Weight</div><div style={{fontSize:12,color:C.text3,fontWeight:500}}>Scale trends down 5-7 days ‚Äî add carbs immediately</div></div>
    <Card style={{marginBottom:16}}><Label color={C.text3} style={{display:"block",marginBottom:10}}>Log Today</Label><div style={{display:"flex",gap:10}}><input placeholder="163.5" value={inp} onChange={e=>setInp(e.target.value)} inputMode="decimal" style={{flex:1,background:C.bg,border:"1px solid "+C.border2,borderRadius:8,padding:"12px 14px",color:C.text,fontSize:20,fontWeight:700,fontFamily:"inherit",letterSpacing:"-0.02em"}}/><button onClick={log} style={{background:C.pink,border:"none",color:"#fff",padding:"12px 24px",borderRadius:8,fontSize:13,fontWeight:700,cursor:"pointer",fontFamily:"inherit",letterSpacing:"0.06em",textTransform:"uppercase"}}>Log</button></div></Card>
    {latest&&<Card accent={trend!==null&&trend<-0.25?C.pink:C.border} style={{marginBottom:16}}>
      <div style={{display:"flex",justifyContent:"space-around",marginBottom:trend!==null?16:0}}>
        <div style={{textAlign:"center"}}><div style={{fontSize:42,fontWeight:800,letterSpacing:"-0.03em",lineHeight:1}}>{latest}</div><Label color={C.text3} style={{display:"block",marginTop:6}}>lbs ‚Äî Latest</Label></div>
        {trend!==null&&<div style={{textAlign:"center"}}><div style={{fontSize:42,fontWeight:800,color:tc,letterSpacing:"-0.03em",lineHeight:1}}>{trend>0?"+":""}{trend.toFixed(1)}</div><Label color={C.text3} style={{display:"block",marginTop:6}}>lbs ‚Äî 7d trend</Label></div>}
      </div>
      {trend!==null&&trend<-0.25&&<div style={{background:C.pinkDim,border:"1px solid "+C.pinkBorder,borderRadius:8,padding:"10px 12px",fontSize:13,fontWeight:500,color:"#F5A0C0",lineHeight:1.5}}>Scale trending down. Add 200-300 kcal from carbs now. Do not wait.</div>}
      {trend!==null&&trend>0.5&&<div style={{background:C.greenDim,border:"1px solid "+C.green,borderRadius:8,padding:"10px 12px",fontSize:13,fontWeight:500,color:C.green,lineHeight:1.5}}>Scale moving up. Productive surplus.</div>}
    </Card>}
    {last7.length>0&&<Card><Label color={C.text3} style={{display:"block",marginBottom:12}}>Recent</Label>{[...last7].reverse().map((e,i)=><div key={e.id} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:i<last7.length-1?"1px solid "+C.border:"none"}}><span style={{fontSize:13,color:C.text2,fontWeight:500}}>{e.date}</span><span style={{fontSize:15,fontWeight:700,letterSpacing:"-0.01em"}}>{e.weight} lbs</span></div>)}</Card>}
  </div>;
}
function HistoryView({data,setData}){
  const[editId,setEditId]=useState(null);
  const[editData,setEditData]=useState(null);
  function startEdit(s){setEditData(JSON.parse(JSON.stringify(s)));setEditId(s.id);}
  function updSet(ei,si,f,v){setEditData(prev=>({...prev,entries:prev.entries.map((e,i)=>i!==ei?e:{...e,sets:e.sets.map((s,j)=>j!==si?s:{...s,[f]:v})})}));}
  function saveEdit(){setData(prev=>({...prev,sessions:prev.sessions.map(s=>s.id===editData.id?editData:s)}));setEditId(null);}
  return <div className="fade-up" style={{padding:"56px 20px 100px"}}>
    <div style={{marginBottom:20}}><div style={{fontSize:22,fontWeight:800,letterSpacing:"-0.02em",marginBottom:4}}>History</div><div style={{fontSize:12,color:C.text3,fontWeight:500}}>{data.sessions.length} sessions logged</div></div>
    {!data.sessions.length&&<div style={{textAlign:"center",padding:"60px 0",color:C.text3,fontSize:14}}>No sessions yet.</div>}
    {[...data.sessions].reverse().map((s,i)=>{
      const day=DAYS.find(d=>d.id===s.dayId);
      if(editId===s.id&&editData)return <div key={s.id||i} style={{border:"1px solid "+C.pink,borderRadius:12,marginBottom:10,background:C.bg1,padding:16}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
          <Label color={C.pink}>Editing ‚Äî {s.date}</Label>
          <div style={{display:"flex",gap:8}}>
            <button onClick={()=>setEditId(null)} style={{background:"none",border:"1px solid "+C.border,color:C.text2,padding:"6px 12px",borderRadius:7,fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"inherit"}}>Cancel</button>
            <button onClick={saveEdit} style={{background:C.green,border:"none",color:"#fff",padding:"6px 14px",borderRadius:7,fontSize:11,fontWeight:700,cursor:"pointer",fontFamily:"inherit"}}>Save</button>
          </div>
        </div>
        {editData.entries&&editData.entries.map((entry,ei)=><div key={ei} style={{marginBottom:14}}>
          <div style={{fontSize:12,fontWeight:600,color:C.text2,marginBottom:8}}>{entry.exerciseName}</div>
          {entry.sets.map((s,si)=><div key={si} style={{display:"flex",gap:6,marginBottom:6}}>
            <input value={s.weight||""} onChange={e=>updSet(ei,si,"weight",e.target.value)} placeholder="lbs" inputMode="decimal" style={{flex:1,background:C.bg,border:"1px solid "+C.border2,borderRadius:6,padding:"8px",color:C.text,fontSize:14,fontWeight:600,fontFamily:"inherit",textAlign:"center"}}/>
            <input value={s.reps||""} onChange={e=>updSet(ei,si,"reps",e.target.value)} placeholder="reps" inputMode="numeric" style={{flex:1,background:C.bg,border:"1px solid "+C.border2,borderRadius:6,padding:"8px",color:C.text,fontSize:14,fontWeight:600,fontFamily:"inherit",textAlign:"center"}}/>
            <input value={s.rpe||""} onChange={e=>updSet(ei,si,"rpe",e.target.value)} placeholder="RPE" inputMode="decimal" style={{width:56,background:C.bg,border:"1px solid "+C.border2,borderRadius:6,padding:"8px",color:C.text,fontSize:14,fontWeight:600,fontFamily:"inherit",textAlign:"center"}}/>
          </div>)}
        </div>)}
      </div>;
      return <SessionCard key={s.id||i} session={s} day={day} onEdit={()=>startEdit(s)}/>;
    })}
  </div>;
}
function SessionCard({session,day,onEdit}){
  const[open,setOpen]=useState(false);
  return <div style={{border:"1px solid "+C.border,borderRadius:12,marginBottom:8,overflow:"hidden",background:C.bg1}}>
    <div onClick={()=>setOpen(!open)} style={{padding:"13px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:12}}>
      <div style={{width:3,height:32,background:day?day.color:C.slate,borderRadius:3,flexShrink:0}}/>
      <div style={{flex:1}}>
        <div style={{fontSize:10,fontWeight:700,letterSpacing:"0.1em",textTransform:"uppercase",color:day?day.color:C.slate,marginBottom:2}}>{session.date}</div>
        <div style={{fontSize:14,fontWeight:600}}>{session.type==="rest"?(session.restType||"Rest Day"):(day?day.label+" ‚Äî "+day.sublabel:"Training")}</div>
      </div>
      <div style={{color:C.text3,fontSize:16,fontWeight:300}}>{open?"‚àí":"+"}</div>
    </div>
    {open&&<div style={{borderTop:"1px solid "+C.border,padding:"0 16px 14px"}}>
      {session.type==="rest"?<div style={{paddingTop:12,fontSize:13,color:C.text3}}>{session.notes||"No notes."}</div>
      :<div>
        {session.entries&&session.entries.map((entry,i)=><div key={i} style={{paddingTop:i===0?12:8,marginBottom:8}}>
          <div style={{fontSize:11,fontWeight:700,color:C.text2,marginBottom:6,letterSpacing:"0.04em"}}>{entry.exerciseName}</div>
          <div style={{display:"flex",flexWrap:"wrap",gap:5}}>{entry.sets.map((s,si)=><div key={si} style={{background:C.bg2,borderRadius:7,padding:"5px 9px",fontSize:11,fontWeight:500,color:C.text2}}>{s.weight?s.weight+"lb":"BW"} x {s.reps}{s.rpe?" @"+s.rpe:""}</div>)}</div>
        </div>)}
        <button onClick={onEdit} style={{marginTop:8,background:"none",border:"1px solid "+C.border,color:C.text2,padding:"7px 14px",borderRadius:8,fontSize:11,fontWeight:600,letterSpacing:"0.06em",textTransform:"uppercase",cursor:"pointer",fontFamily:"inherit"}}>Edit</button>
      </div>}
    </div>}
  </div>;
}
function CoachView({data,setData,alerts,isDeload}){
  const[resetConfirm,setResetConfirm]=useState(false);
  const trainingSessions=data.sessions.filter(s=>s.type==="training").length;
  const nextDeload=Math.ceil(data.weekCount/DELOAD_EVERY)*DELOAD_EVERY;
  return <div className="fade-up" style={{padding:"56px 20px 100px"}}>
    <div style={{marginBottom:20}}><div style={{fontSize:22,fontWeight:800,letterSpacing:"-0.02em",marginBottom:4}}>Coach</div><div style={{fontSize:12,color:C.text3,fontWeight:500}}>Protocol intelligence</div></div>
    <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,marginBottom:16}}>
      {[[data.weekCount,"Week",isDeload?C.pink:C.text],[trainingSessions,"Sessions",C.text],[Math.floor(data.weekCount/DELOAD_EVERY),"Deloads",C.text]].map(([n,l,color])=><div key={l} style={{background:C.bg1,border:"1px solid "+(l==="Week"&&isDeload?C.pink:C.border),borderRadius:12,padding:"14px 0",textAlign:"center"}}><div style={{fontSize:32,fontWeight:800,color,letterSpacing:"-0.03em",lineHeight:1}}>{n}</div><Label color={C.text3} style={{display:"block",marginTop:6}}>{l}</Label></div>)}
    </div>
    <Card accent={isDeload?C.pink:C.border} style={{marginBottom:16}}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
        <div><Label color={C.text3} style={{display:"block",marginBottom:6}}>Next Deload</Label><div style={{fontSize:24,fontWeight:800,color:C.pink,letterSpacing:"-0.02em"}}>Week {nextDeload}</div></div>
        {isDeload&&<div style={{background:C.pinkDim,border:"1px solid "+C.pinkBorder,borderRadius:8,padding:"6px 12px",fontSize:11,fontWeight:700,color:C.pink,letterSpacing:"0.06em",textTransform:"uppercase"}}>Active Now</div>}
      </div>
      {isDeload&&<div style={{marginTop:12,background:C.pinkDim,border:"1px solid "+C.pinkBorder,borderRadius:8,padding:"10px 12px",fontSize:13,fontWeight:500,color:"#F5A0C0",lineHeight:1.5}}>60% weights, half sets, RPE 6 cap. Do not skip.</div>}
    </Card>
    {!alerts.length?<Card accent={C.green} style={{marginBottom:16}}><div style={{fontSize:14,fontWeight:600,color:C.green}}>No alerts. Stay the course.</div></Card>
    :alerts.map((a,i)=><Card key={i} accent={a.type==="deload"?C.pink:a.type==="weight"?C.amber:C.green} style={{marginBottom:10}}>
      <Label color={a.type==="deload"?C.pink:a.type==="weight"?C.amber:C.green} style={{display:"block",marginBottom:8}}>{a.type==="deload"?"Deload Required":a.type==="weight"?"Scale Alert":"Add Weight"}</Label>
      <div style={{fontSize:14,fontWeight:500,lineHeight:1.6}}>{a.msg}</div>
    </Card>)}
    <Card style={{marginBottom:16}}>
      <Label color={C.text3} style={{display:"block",marginBottom:12}}>Phase Plan</Label>
      {[["Months 1-4","Foundation Gain","2700-2900 training / 2400-2500 rest"],["Month 5","Mini-Cut","2400-2500 training / 2200-2300 rest ¬∑ 3-4 weeks"],["Months 6-9","Density Gain","2800-3000 training / 2500-2600 rest"],["Month 10","Mini-Cut","2400-2500 training / 2200-2300 rest ¬∑ 2-3 weeks"],["Months 11-12","Finish Strong","2800-3000 training / 2500 rest"]].map(([period,name,detail])=><div key={name} style={{padding:"10px 0",borderBottom:"1px solid "+C.border}}><div style={{display:"flex",justifyContent:"space-between",marginBottom:3}}><div style={{fontSize:13,fontWeight:700}}>{name}</div><Label color={C.text3}>{period}</Label></div><div style={{fontSize:12,color:C.text3,lineHeight:1.5}}>{detail}</div></div>)}
    </Card>
    {!resetConfirm?<button onClick={()=>setResetConfirm(true)} style={{width:"100%",background:"none",border:"1px solid "+C.border,color:C.text3,padding:"10px 0",borderRadius:10,fontSize:11,fontWeight:600,letterSpacing:"0.08em",textTransform:"uppercase",cursor:"pointer",fontFamily:"inherit",marginTop:8}}>Reset All Data</button>
    :<Card accent={C.redBorder} style={{background:C.redDim}}><ConfirmInline message="Delete all data? Cannot be undone." onConfirm={()=>{setData({sessions:[],weightLog:[],nutritionLog:[],weekCount:1,sessionCount:0});setResetConfirm(false);}} onCancel={()=>setResetConfirm(false)} confirmLabel="Yes delete" cancelLabel="Keep data"/></Card>}
  </div>;
}
function App(){
  const[data,setData]=useState(loadData);
  const[view,setView]=useState("home");
  const[session,setSession]=useState(null);
  const[sessionDone,setSessionDone]=useState(false);
  const[alerts,setAlerts]=useState([]);
  useEffect(()=>{try{localStorage.setItem("cp_v5",JSON.stringify(data));}catch{}},[data]);
  useEffect(()=>{
    const a=[];
    if(data.weekCount%DELOAD_EVERY===0)a.push({type:"deload",msg:"Week "+data.weekCount+" is a DELOAD week. 60% weights, half sets, RPE 6 max."});
    DAYS.forEach(day=>day.exercises.forEach(ex=>{const flag=checkProg(data.sessions,ex.name,ex.rr);if(flag)a.push({type:"progress",msg:ex.name+": Hit top of rep range two sessions running. Add weight next session."});}));
    const trend=getTrend(data.weightLog);
    if(trend!==null&&trend<-0.25)a.push({type:"weight",msg:"Scale trending down. Add 200-300 kcal from carbs now per your protocol."});
    setAlerts(a);
  },[data]);
  const isDeload=data.weekCount%DELOAD_EVERY===0;
  const activeDay=session?DAYS.find(d=>d.id===session.dayId):null;
  const inActiveSession=view==="log"&&session&&!sessionDone;
  function startSession(dayId){
    const day=DAYS.find(d=>d.id===dayId);if(!day||!day.exercises.length)return;
    setSession({dayId,exercises:day.exercises.map(ex=>({name:ex.name,sets:Array.from({length:ex.sets},()=>({weight:"",reps:"",rpe:"",done:false}))}))});
    setSessionDone(false);setView("log");
  }
  function logRest(type,notes){setData(prev=>{const sc=prev.sessionCount+1,wc=sc%6===0?prev.weekCount+1:prev.weekCount;return{...prev,sessions:[...prev.sessions,{date:todayStr(),dayId:6,type:"rest",restType:type,notes,id:Date.now()}],sessionCount:sc,weekCount:wc};});}
  function finishSession(){
    const entries=session.exercises.map(ex=>({exerciseName:ex.name,sets:ex.sets.filter(s=>s.reps).map(s=>({weight:s.weight,reps:s.reps,rpe:s.rpe}))}));
    setData(prev=>{const sc=prev.sessionCount+1,wc=sc%6===0?prev.weekCount+1:prev.weekCount;return{...prev,sessions:[...prev.sessions,{date:todayStr(),dayId:session.dayId,type:"training",entries,id:Date.now()}],sessionCount:sc,weekCount:wc};});
    setSessionDone(true);
  }
  return <div style={{background:C.bg,minHeight:"100vh",maxWidth:480,margin:"0 auto",position:"relative"}}>
    {view==="home"&&<HomeView data={data} alerts={alerts} isDeload={isDeload} onStartSession={startSession} onLogRest={logRest} setView={setView}/>}
    {view==="nutrition"&&<NutritionView data={data} setData={setData}/>}
    {view==="weight"&&<WeightView data={data} setData={setData}/>}
    {view==="history"&&<HistoryView data={data} setData={setData}/>}
    {view==="coach"&&<CoachView data={data} setData={setData} alerts={alerts} isDeload={isDeload}/>}
    {view==="log"&&sessionDone&&<SessionDone alerts={alerts} onBack={()=>{setSession(null);setSessionDone(false);setView("home");}}/>}
    {inActiveSession&&<LogView data={data} session={session} setSession={setSession} activeDay={activeDay} isDeload={isDeload} onFinish={finishSession} onCancel={()=>{setSession(null);setSessionDone(false);setView("home");}}/>}
    {!inActiveSession&&<BottomNav view={view} setView={setView} alertCount={alerts.length}/>}
  </div>;
}
ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
